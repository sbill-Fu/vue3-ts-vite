import{d as te,r as E,b as _,l as ae,k as B,D as oe,c as U,e as h,f as e,w as t,A as w,q as g,n as z,E as D,i as n,G as se,o as d,F as q,p as M,j as i,H as re,y as ne}from"./index.bc6e1629.js";const de={class:"user-manage"},ie={class:"query-form"},pe=i("\u67E5\u8BE2"),me=i("\u91CD\u7F6E"),ce={class:"base-table"},_e={class:"action"},be=i("\u65B0\u589E"),Fe=i("\u6279\u91CF\u5220\u9664"),fe=i("\u7F16\u8F91"),Be=i("\u5220\u9664"),ge=i("@imooc.com"),ve={class:"dialog-footer"},Ee=i("\u53D6 \u6D88"),De=i("\u786E \u5B9A"),he=te({__name:"User",setup(Ve){const p=E({state:1,userId:"",userName:""}),A=_([]),b=E({pageNum:1,pageSize:10}),y=_([]),F=_(!1),s=E({state:3,userId:0,userName:"",userEmail:"",mobile:"",job:"",roleList:[],deptId:""}),L=_([]),x=_([]),v=_("add"),R=E({userName:[{required:!0,message:"\u8BF7\u8F93\u5165\u7528\u6237\u540D\u79F0",trigger:"blur"}],userEmail:[{required:!0,message:"\u8BF7\u8F93\u5165\u7528\u6237\u90AE\u7BB1",trigger:"blur"}],mobile:[{pattern:/1[3-9]\d{9}/,message:"\u8BF7\u8F93\u5165\u6B63\u786E\u7684\u624B\u673A\u53F7\u683C\u5F0F",trigger:"blur"}],deptId:[{required:!0,message:"\u8BF7\u8F93\u5165\u7528\u6237\u90AE\u7BB1",trigger:"blur"}]}),T=E([{label:"\u7528\u6237ID",prop:"userId"},{label:"\u7528\u6237\u540D",prop:"userName"},{label:"\u7528\u6237\u90AE\u7BB1",prop:"userEmail"},{label:"\u7528\u6237\u89D2\u8272",prop:"role",formatter(a,u,o){return{0:"\u7BA1\u7406\u5458",1:"\u666E\u901A\u7528\u6237"}[o]}},{label:"\u7528\u6237\u72B6\u6001",prop:"state",formatter(a,u,o){return{1:"\u5728\u804C",2:"\u79BB\u804C",3:"\u8BD5\u7528\u671F"}[o]}},{label:"\u6CE8\u518C\u65F6\u95F4",prop:"createTime",width:180,formatter:(a,u,o)=>z.formateDate(new Date(o))},{label:"\u6700\u540E\u767B\u5F55\u65F6\u95F4",prop:"lastLoginTime",width:180,formatter:(a,u,o)=>z.formateDate(new Date(o))}]);ae(()=>{f(),Q(),J()});const f=async()=>{let a={...p,...b};try{const{list:u,page:o}=await B.getUserList(a);A.value=u,b.total=o.total}catch{}},$=()=>{f()},S=_(),k=a=>{a&&a.resetFields()};oe(()=>b.pageNum,()=>{f()});const G=async a=>{await B.userDel({userIds:[a.userId]}),D.success("\u5220\u9664\u6210\u529F"),f()},H=async()=>{if(y.value.length==0){D.error("\u8BF7\u9009\u62E9\u8981\u5220\u9664\u7684\u7528\u6237");return}(await B.userDel({userIds:y.value})).nModified>0?(D.success("\u5220\u9664\u6210\u529F"),f()):D.success("\u4FEE\u6539\u5931\u8D25")},O=a=>{let u=[];a.map(o=>{u.push(o.userId)}),y.value=u},P=()=>{v.value="add",F.value=!0},Q=async()=>{let a=await B.getDeptList();x.value=a},J=async()=>{let a=await B.getRoleAllList();L.value=a},V=_(),K=()=>{F.value=!1,k(V.value)},W=()=>{var a;(a=V.value)==null||a.validate(async u=>{if(u){let o=re(s);o.userEmail+="@imooc.com",o.action=v.value,await B.userSubmit(o),F.value=!1,D.success("\u7528\u6237\u521B\u5EFA\u6210\u529F"),k(V.value),f()}})},X=a=>{v.value="edit",F.value=!0,ne(()=>{Object.assign(s,a)})};return(a,u)=>{const o=n("el-input"),r=n("el-form-item"),m=n("el-option"),N=n("el-select"),c=n("el-button"),j=n("el-form"),I=n("el-table-column"),Y=n("el-table"),Z=n("el-pagination"),ee=n("el-cascader"),ue=n("el-dialog"),C=se("has");return d(),U("div",de,[h("div",ie,[e(j,{ref_key:"form",ref:S,inline:!0,model:p},{default:t(()=>[e(r,{label:"\u7528\u6237ID",prop:"userId"},{default:t(()=>[e(o,{modelValue:p.userId,"onUpdate:modelValue":u[0]||(u[0]=l=>p.userId=l),placeholder:"\u8BF7\u8F93\u5165\u7528\u6237ID"},null,8,["modelValue"])]),_:1}),e(r,{label:"\u7528\u6237\u540D\u79F0",prop:"userName"},{default:t(()=>[e(o,{modelValue:p.userName,"onUpdate:modelValue":u[1]||(u[1]=l=>p.userName=l),placeholder:"\u8BF7\u8F93\u5165\u7528\u6237\u540D\u79F0"},null,8,["modelValue"])]),_:1}),e(r,{label:"\u72B6\u6001",prop:"state"},{default:t(()=>[e(N,{modelValue:p.state,"onUpdate:modelValue":u[2]||(u[2]=l=>p.state=l)},{default:t(()=>[e(m,{value:0,label:"\u6240\u6709"}),e(m,{value:1,label:"\u5728\u804C"}),e(m,{value:2,label:"\u79BB\u804C"}),e(m,{value:3,label:"\u8BD5\u7528\u671F"})]),_:1},8,["modelValue"])]),_:1}),e(r,null,{default:t(()=>[e(c,{type:"primary",onClick:$},{default:t(()=>[pe]),_:1}),e(c,{onClick:u[3]||(u[3]=l=>k(S.value))},{default:t(()=>[me]),_:1})]),_:1})]),_:1},8,["model"])]),h("div",ce,[h("div",_e,[w((d(),g(c,{type:"primary",onClick:P},{default:t(()=>[be]),_:1})),[[C,"user-create"]]),w((d(),g(c,{type:"danger",onClick:H},{default:t(()=>[Fe]),_:1})),[[C,"user-patch-delete"]])]),e(Y,{data:A.value,onSelectionChange:O},{default:t(()=>[e(I,{type:"selection",width:"55"}),(d(!0),U(q,null,M(T,l=>(d(),g(I,{key:l.prop,prop:l.prop,label:l.label,width:l.width,formatter:l.formatter},null,8,["prop","label","width","formatter"]))),128)),e(I,{label:"\u64CD\u4F5C",width:"150"},{default:t(l=>[w((d(),g(c,{onClick:le=>X(l.row),size:"small"},{default:t(()=>[fe]),_:2},1032,["onClick"])),[[C,"user-edit"]]),w((d(),g(c,{type:"danger",size:"small",onClick:le=>G(l.row)},{default:t(()=>[Be]),_:2},1032,["onClick"])),[[C,"user-delete"]])]),_:1})]),_:1},8,["data"]),e(Z,{class:"pagination",background:"",layout:"prev, pager, next",total:b.total,"page-size":b.pageSize,"current-page":b.pageNum,"onUpdate:current-page":u[4]||(u[4]=l=>b.pageNum=l)},null,8,["total","page-size","current-page"])]),e(ue,{title:"\u7528\u6237\u65B0\u589E",modelValue:F.value,"onUpdate:modelValue":u[12]||(u[12]=l=>F.value=l)},{footer:t(()=>[h("span",ve,[e(c,{onClick:K},{default:t(()=>[Ee]),_:1}),e(c,{type:"primary",onClick:W},{default:t(()=>[De]),_:1})])]),default:t(()=>[e(j,{ref_key:"dialogForm",ref:V,model:s,"label-width":"100px",rules:R},{default:t(()=>[e(r,{label:"\u7528\u6237\u540D",prop:"userName"},{default:t(()=>[e(o,{modelValue:s.userName,"onUpdate:modelValue":u[5]||(u[5]=l=>s.userName=l),disabled:v.value=="edit",placeholder:"\u8BF7\u8F93\u5165\u7528\u6237\u540D\u79F0"},null,8,["modelValue","disabled"])]),_:1}),e(r,{label:"\u90AE\u7BB1",prop:"userEmail"},{default:t(()=>[e(o,{modelValue:s.userEmail,"onUpdate:modelValue":u[6]||(u[6]=l=>s.userEmail=l),disabled:v.value=="edit",placeholder:"\u8BF7\u8F93\u5165\u7528\u6237\u90AE\u7BB1"},{append:t(()=>[ge]),_:1},8,["modelValue","disabled"])]),_:1}),e(r,{label:"\u624B\u673A\u53F7",prop:"mobile"},{default:t(()=>[e(o,{modelValue:s.mobile,"onUpdate:modelValue":u[7]||(u[7]=l=>s.mobile=l),placeholder:"\u8BF7\u8F93\u5165\u624B\u673A\u53F7"},null,8,["modelValue"])]),_:1}),e(r,{label:"\u5C97\u4F4D",prop:"job"},{default:t(()=>[e(o,{modelValue:s.job,"onUpdate:modelValue":u[8]||(u[8]=l=>s.job=l),placeholder:"\u8BF7\u8F93\u5165\u5C97\u4F4D"},null,8,["modelValue"])]),_:1}),e(r,{label:"\u72B6\u6001",prop:"state"},{default:t(()=>[e(N,{modelValue:s.state,"onUpdate:modelValue":u[9]||(u[9]=l=>s.state=l)},{default:t(()=>[e(m,{value:1,label:"\u5728\u804C"}),e(m,{value:2,label:"\u79BB\u804C"}),e(m,{value:3,label:"\u8BD5\u7528\u671F"})]),_:1},8,["modelValue"])]),_:1}),e(r,{label:"\u7CFB\u7EDF\u89D2\u8272",prop:"roleList"},{default:t(()=>[e(N,{modelValue:s.roleList,"onUpdate:modelValue":u[10]||(u[10]=l=>s.roleList=l),placeholder:"\u8BF7\u9009\u62E9\u7528\u6237\u7CFB\u7EDF\u89D2\u8272",multiple:"",style:{width:"100%"}},{default:t(()=>[(d(!0),U(q,null,M(L.value,l=>(d(),g(m,{key:l.id,label:l.roleName,value:l._id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),e(r,{label:"\u90E8\u95E8",prop:"deptId"},{default:t(()=>[e(ee,{modelValue:s.deptId,"onUpdate:modelValue":u[11]||(u[11]=l=>s.deptId=l),placeholder:"\u8BF7\u9009\u62E9\u6240\u5C5E\u90E8\u95E8",options:x.value,props:{checkStrictly:!0,value:"_id",label:"deptName"},clearable:"",style:{width:"100%"}},null,8,["modelValue","options"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue"])])}}});export{he as default};
