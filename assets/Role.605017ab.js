import{d as X,b as r,l as Y,k as F,c as A,e as k,f as l,w as a,i as m,o as S,v as Z,F as ee,p as le,j as i,t as te,u as ae,C as oe,n as T,y as ue,E}from"./index.bc6e1629.js";const se={class:"role-manage"},ne={class:"query-form"},re=i("\u67E5\u8BE2"),ie=i("\u91CD\u7F6E"),de={class:"base-table"},ce={class:"action"},me=i("\u521B\u5EFA"),pe=i("\u7F16\u8F91"),_e=i("\u8BBE\u7F6E\u6743\u9650"),fe=i("\u5220\u9664"),ve={class:"dialog-footer"},he=i("\u53D6 \u6D88"),ye=i("\u786E \u5B9A"),Fe={class:"dialog-footer"},ke=i("\u53D6 \u6D88"),ge=i("\u786E \u5B9A"),we=X({__name:"Role",setup(Ce){const g=r({roleName:""});let N={};const R=[{label:"\u89D2\u8272\u540D\u79F0",prop:"roleName"},{label:"\u5907\u6CE8",prop:"remark"},{label:"\u6743\u9650\u5217\u8868",prop:"permissionList",width:200,formatter:(e,t,s)=>{let n=[];return(s.halfCheckedKeys||[]).map(d=>{let c=N[d];d&&c&&n.push(c)}),n.join(",")}},{label:"\u66F4\u65B0\u65F6\u95F4",prop:"updateTime",formatter(e,t,s){return T.formateDate(new Date(s))}},{label:"\u521B\u5EFA\u65F6\u95F4",prop:"createTime",formatter(e,t,s){return T.formateDate(new Date(s))}}],B=r([]),v=r({total:0,pageNum:1,pageSize:10}),f=r(!1);let w="create";const p=r({}),O={roleName:[{required:!0,message:"\u8BF7\u8F93\u5165\u89D2\u8272\u89D2\u8272\u540D\u79F0"}]},h=r(!1);let V="";const x=r(""),K=r([]),L=r(),C=r(),b=r();Y(()=>{_(),U()});const _=async()=>{try{let{list:e,page:t}=await F.getRoleList({...g.value,...v.value});B.value=e,v.value.total=t.total}catch(e){throw new Error(e)}},U=async()=>{try{let e=await F.getMenuList();K.value=e,Q(e)}catch(e){throw new Error(e)}},D=e=>{e&&e.resetFields()},$=()=>{w="create",f.value=!0},P=e=>{w="edit",f.value=!0,ue(()=>{p.value={_id:e._id,roleName:e.roleName,remark:e.remark}})},q=async e=>{await F.roleOperate({_id:e,action:"delete"}),E.success("\u5220\u9664\u6210\u529F"),_()},j=()=>{D(C.value),f.value=!1},J=()=>{var e;(e=C.value)==null||e.validate(async t=>{if(t){let s={...p.value,action:w};await F.roleOperate(s)&&(f.value=!1,E.success("\u521B\u5EFA\u6210\u529F"),D(C.value),_())}})},H=e=>{v.value.pageNum=e,_()},G=e=>{V=e._id,x.value=e.roleName,h.value=!0;let{checkedKeys:t}=e.permissionList;setTimeout(()=>{var s;(s=b.value)==null||s.setCheckedKeys(t)})},I=async()=>{var d,c;let e=(d=b.value)==null?void 0:d.getCheckedNodes(),t=(c=b.value)==null?void 0:c.getHalfCheckedKeys(),s=[],n=[];e==null||e.map(y=>{y.children?n.push(y._id):s.push(y._id)});let o={_id:V,permissionList:{checkedKeys:s,halfCheckedKeys:n.concat(t)}};await F.updatePermission(o),h.value=!1,E.success("\u8BBE\u7F6E\u6210\u529F"),_()},Q=e=>{let t={};const s=n=>{for(;n.length;){let o=n.pop();if(!o)break;o.children&&o.action&&(t[o._id]=o.menuName),o.children&&!o.action&&s(o.children)}};s(JSON.parse(JSON.stringify(e))),N=t};return(e,t)=>{const s=m("el-input"),n=m("el-form-item"),o=m("el-button"),d=m("el-form"),c=m("el-table-column"),y=m("el-table"),W=m("el-pagination"),M=m("el-dialog");return S(),A("div",se,[k("div",ne,[l(d,{ref_key:"form",ref:L,inline:!0,model:g.value},{default:a(()=>[l(n,{label:"\u89D2\u8272\u540D\u79F0",prop:"roleName"},{default:a(()=>[l(s,{modelValue:g.value.roleName,"onUpdate:modelValue":t[0]||(t[0]=u=>g.value.roleName=u),placeholder:"\u8BF7\u8F93\u5165\u89D2\u8272\u540D\u79F0",onKeyup:Z(_,["enter","native"])},null,8,["modelValue","onKeyup"])]),_:1}),l(n,null,{default:a(()=>[l(o,{type:"primary",onClick:_},{default:a(()=>[re]),_:1}),l(o,{onClick:t[1]||(t[1]=u=>D(L.value))},{default:a(()=>[ie]),_:1})]),_:1})]),_:1},8,["model"])]),k("div",de,[k("div",ce,[l(o,{type:"primary",onClick:$},{default:a(()=>[me]),_:1})]),l(y,{data:B.value},{default:a(()=>[(S(),A(ee,null,le(R,u=>l(c,{key:u.prop,prop:u.prop,label:u.label,width:u.width,formatter:u.formatter},null,8,["prop","label","width","formatter"])),64)),l(c,{label:"\u64CD\u4F5C",width:"260"},{default:a(u=>[l(o,{size:"small",onClick:z=>P(u.row)},{default:a(()=>[pe]),_:2},1032,["onClick"]),l(o,{size:"small",type:"primary",onClick:z=>G(u.row)},{default:a(()=>[_e]),_:2},1032,["onClick"]),l(o,{type:"danger",size:"small",onClick:z=>q(u.row._id)},{default:a(()=>[fe]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"]),l(W,{class:"pagination",background:"",layout:"prev, pager, next",total:v.value.total,"page-size":v.value.pageSize,onCurrentChange:H},null,8,["total","page-size"])]),l(M,{title:"\u7528\u6237\u65B0\u589E",modelValue:f.value,"onUpdate:modelValue":t[4]||(t[4]=u=>f.value=u)},{footer:a(()=>[k("span",ve,[l(o,{onClick:j},{default:a(()=>[he]),_:1}),l(o,{type:"primary",onClick:J},{default:a(()=>[ye]),_:1})])]),default:a(()=>[l(d,{ref_key:"dialogForm",ref:C,model:p.value,"label-width":"100px",rules:O},{default:a(()=>[l(n,{label:"\u89D2\u8272\u540D\u79F0",prop:"roleName"},{default:a(()=>[l(s,{modelValue:p.value.roleName,"onUpdate:modelValue":t[2]||(t[2]=u=>p.value.roleName=u),placeholder:"\u8BF7\u8F93\u5165\u89D2\u8272\u540D\u79F0"},null,8,["modelValue"])]),_:1}),l(n,{label:"\u5907\u6CE8",prop:"remark"},{default:a(()=>[l(s,{type:"textarea",rows:2,modelValue:p.value.remark,"onUpdate:modelValue":t[3]||(t[3]=u=>p.value.remark=u),placeholder:"\u8BF7\u8F93\u5165\u5907\u6CE8"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"]),l(M,{title:"\u6743\u9650\u8BBE\u7F6E",modelValue:h.value,"onUpdate:modelValue":t[6]||(t[6]=u=>h.value=u)},{footer:a(()=>[k("span",Fe,[l(o,{onClick:t[5]||(t[5]=u=>h.value=!1)},{default:a(()=>[ke]),_:1}),l(o,{type:"primary",onClick:I},{default:a(()=>[ge]),_:1})])]),default:a(()=>[l(d,{"label-width":"100px"},{default:a(()=>[l(n,{label:"\u89D2\u8272\u540D\u79F0"},{default:a(()=>[i(te(x.value),1)]),_:1}),l(n,{label:"\u9009\u62E9\u6743\u9650"},{default:a(()=>[l(ae(oe),{ref_key:"tree",ref:b,data:K.value,"show-checkbox":"","node-key":"_id","default-expand-all":"",props:{label:"menuName"}},null,8,["data"])]),_:1})]),_:1})]),_:1},8,["modelValue"])])}}});export{we as default};
