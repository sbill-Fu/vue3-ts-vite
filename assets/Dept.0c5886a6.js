import{d as P,b as n,l as G,k as v,c as y,e as F,f as u,w as l,i as s,o as f,v as H,F as C,p as N,x as J,q as Q,j as i,y as W,E as w}from"./index.bc6e1629.js";const X={class:"dept-manage"},Y={class:"query-form"},Z=i("\u67E5\u8BE2"),ee=i("\u91CD\u7F6E"),ue={class:"base-table"},le={class:"action"},ae=i("\u521B\u5EFA"),te=i("\u7F16\u8F91"),oe=i("\u5220\u9664"),se={class:"dialog-footer"},ne=i("\u53D6\u6D88"),re=i("\u786E\u5B9A"),ie=P({__name:"Dept",setup(de){const E=n({deptName:""}),U=[{label:"\u90E8\u95E8\u540D\u79F0",prop:"deptName"},{label:"\u8D1F\u8D23\u4EBA",prop:"userName"},{label:"\u66F4\u65B0\u65F6\u95F4",prop:"updateTime"},{label:"\u521B\u5EFA\u65F6\u95F4",prop:"createTime"}],b=n([]);n({pageNum:1,pageSize:10});const c=n("create"),m=n(!1),o=n({parentId:[null]}),D=n([]),$={parentId:[{required:!0,message:"\u8BF7\u9009\u62E9\u4E0A\u7EA7\u90E8\u95E8",trigger:"blur"}],deptName:[{required:!0,message:"\u8BF7\u8F93\u5165\u90E8\u95E8\u540D\u79F0",trigger:"blur"}],user:[{required:!0,message:"\u8BF7\u9009\u62E9\u8D1F\u8D23\u4EBA",trigger:"blur"}]},g=n(),B=n();G(()=>{_(),q()});const _=async()=>{let t=await v.getDeptList(E.value);b.value=t},q=async()=>{D.value=await v.getAllUserList()},I=t=>{const[a,r,d]=t.split("/");o.value={...o.value,userId:a,userName:r,userEmail:d}},V=t=>{t&&t.resetFields()},x=()=>{c.value="create",m.value=!0},L=t=>{c.value="edit",m.value=!0,W(()=>{o.value=t,o.value.user=`${t.userId}/${t.userName}/${t.userEmail}`})},T=async t=>{c.value="delete",await v.deptOperate({_id:t,action:c.value}),w.success("\u5220\u9664\u6210\u529F"),_()},h=()=>{m.value=!1,V(B.value)},z=()=>{var t;(t=B.value)==null||t.validate(async a=>{if(a){let r={...o.value,action:c.value};delete r.user,await v.deptOperate(r),w.success("\u64CD\u4F5C\u6210\u529F"),h(),_()}})};return(t,a)=>{const r=s("el-input"),d=s("el-form-item"),p=s("el-button"),k=s("el-form"),A=s("el-table-column"),K=s("el-table"),M=s("el-cascader"),O=s("el-option"),R=s("el-select"),S=s("el-dialog");return f(),y("div",X,[F("div",Y,[u(k,{inline:!0,ref_key:"queryFormRef",ref:g,model:E.value},{default:l(()=>[u(d,{label:"\u90E8\u95E8\u540D\u79F0"},{default:l(()=>[u(r,{placeholder:"\u8BF7\u8F93\u5165\u90E8\u95E8\u540D\u79F0",modelValue:E.value.deptName,"onUpdate:modelValue":a[0]||(a[0]=e=>E.value.deptName=e),onKeyup:H(_,["enter","native"])},null,8,["modelValue","onKeyup"])]),_:1}),u(d,null,{default:l(()=>[u(p,{onClick:_,type:"primary"},{default:l(()=>[Z]),_:1}),u(p,{onClick:a[1]||(a[1]=e=>V(g.value))},{default:l(()=>[ee]),_:1})]),_:1})]),_:1},8,["model"])]),F("div",ue,[F("div",le,[u(p,{type:"primary",onClick:x},{default:l(()=>[ae]),_:1})]),u(K,{data:b.value,"row-key":"_id","tree-props":{children:"children"},stripe:""},{default:l(()=>[(f(),y(C,null,N(U,e=>u(A,J({key:e.prop},e),null,16)),64)),u(A,{label:"\u64CD\u4F5C"},{default:l(e=>[u(p,{size:"small",type:"primary",onClick:j=>L(e.row)},{default:l(()=>[te]),_:2},1032,["onClick"]),u(p,{size:"small",type:"danger",onClick:j=>T(e.row._id)},{default:l(()=>[oe]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])]),u(S,{title:c.value=="create"?"\u521B\u5EFA\u90E8\u95E8":"\u7F16\u8F91\u90E8\u95E8",modelValue:m.value,"onUpdate:modelValue":a[6]||(a[6]=e=>m.value=e)},{footer:l(()=>[F("span",se,[u(p,{onClick:h},{default:l(()=>[ne]),_:1}),u(p,{onClick:z,type:"primary"},{default:l(()=>[re]),_:1})])]),default:l(()=>[u(k,{ref_key:"dialogForm",ref:B,model:o.value,rules:$,"label-width":"120px"},{default:l(()=>[u(d,{label:"\u4E0A\u7EA7\u90E8\u95E8",prop:"parentId"},{default:l(()=>[u(M,{placeholder:"\u8BF7\u9009\u62E9\u4E0A\u7EA7\u90E8\u95E8",modelValue:o.value.parentId,"onUpdate:modelValue":a[2]||(a[2]=e=>o.value.parentId=e),props:{checkStrictly:!0,value:"_id",label:"deptName"},clearable:"",options:b.value,"show-all-levels":!0},null,8,["modelValue","options"])]),_:1}),u(d,{label:"\u90E8\u95E8\u540D\u79F0",prop:"deptName"},{default:l(()=>[u(r,{placeholder:"\u8BF7\u8F93\u5165\u90E8\u95E8\u540D\u79F0",modelValue:o.value.deptName,"onUpdate:modelValue":a[3]||(a[3]=e=>o.value.deptName=e)},null,8,["modelValue"])]),_:1}),u(d,{label:"\u8D1F\u8D23\u4EBA",prop:"user"},{default:l(()=>[u(R,{placeholder:"\u8BF7\u9009\u62E9\u90E8\u95E8\u8D1F\u8D23\u4EBA",modelValue:o.value.user,"onUpdate:modelValue":a[4]||(a[4]=e=>o.value.user=e),onChange:I},{default:l(()=>[(f(!0),y(C,null,N(D.value,e=>(f(),Q(O,{key:e.userId,label:e.userName,value:`${e.userId}/${e.userName}/${e.userEmail}`},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),u(d,{label:"\u8D1F\u8D23\u4EBA\u90AE\u7BB1",prop:"userEmail"},{default:l(()=>[u(r,{placeholder:"\u8BF7\u8F93\u5165\u8D1F\u8D23\u4EBA\u90AE\u7BB1",modelValue:o.value.userEmail,"onUpdate:modelValue":a[5]||(a[5]=e=>o.value.userEmail=e),disabled:""},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["title","modelValue"])])}}});export{ie as default};
